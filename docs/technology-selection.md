# 技術選定書

## 1. 概要

このドキュメントでは、サークル運営支援Botの開発に使用する技術スタックとその選定理由を定義します。

## 2. インフラストラクチャ

### クラウドプラットフォーム

#### Fly.io
- **用途**: Discord Botのホスティング
- **選定理由**:
  - 無料枠が十分（最大3インスタンス）
  - コンテナベースのデプロイが容易
  - グローバルエッジロケーションによる低レイテンシー
  - WebSocketsのサポートが優れている

#### Vercel
- **用途**: Web API（スラッシュコマンド処理、OAuth認証）
- **選定理由**:
  - Serverless Functionsの無料枠が十分
  - デプロイが簡単で自動化が容易
  - エッジロケーションによる高速なレスポンス
  - 開発環境との統合が優れている

### データベース

#### Supabase
- **用途**: メインデータベース（PostgreSQL）
- **選定理由**:
  - 無料枠が十分（500MB）
  - PostgreSQLの全機能が利用可能
  - Row Level Security (RLS)による堅牢なセキュリティ
  - リアルタイムサブスクリプション機能
  - バックアップ機能が標準装備
  - データ暗号化機能（Vault）の提供

## 3. バックエンド技術

### Discord Bot

#### discord.py
- **バージョン**: 2.3.x
- **選定理由**:
  - Pythonの非同期処理が優れている
  - ドキュメントが充実している
  - コミュニティが活発
  - スラッシュコマンドのサポートが充実
  - WebSocketsの安定性が高い

### Web API

#### FastAPI
- **バージョン**: 0.109.x
- **選定理由**:
  - 高速なパフォーマンス
  - OpenAPI（Swagger）ドキュメントの自動生成
  - Pythonの型ヒントを活用した開発効率
  - 非同期処理のサポートが優れている
  - ミドルウェアの柔軟な拡張性

### データベースアクセス

#### SQLAlchemy
- **バージョン**: 2.0.x
- **選定理由**:
  - 型安全なクエリビルダー
  - 非同期処理のサポート
  - マイグレーション管理が容易
  - ORMとCore SQLの柔軟な使い分けが可能

## 4. 外部サービス連携

### Microsoft Graph API
- **バージョン**: v1.0
- **用途**: Outlookメールの取得
- **選定理由**:
  - OAuth2.0認証のサポート
  - メール操作の豊富なAPI
  - WebHookによるリアルタイム通知対応
  - SDKが充実している

### Discord API
- **バージョン**: v10
- **用途**: Botコマンドとメッセージ管理
- **選定理由**:
  - スラッシュコマンドの完全サポート
  - インタラクションの豊富な機能
  - WebSocketによるリアルタイム通信

## 5. 開発ツール

### 依存関係管理
- **Poetry**: パッケージ管理とビルド
  - 仮想環境の自動管理
  - 依存関係の厳密なバージョン管理
  - lockファイルによる再現性の確保

### コード品質管理
- **Ruff**: リンターとフォーマッター
  - 高速な実行速度
  - 包括的なルールセット
  - 自動修正機能

### テスト
- **pytest**: テストフレームワーク
  - 豊富なプラグイン
  - 非同期テストのサポート
  - フィクスチャの柔軟な管理

### CI/CD
- **GitHub Actions**: 自動化パイプライン
  - コードチェック
  - テスト実行
  - 自動デプロイ

## 6. 監視とロギング

### アプリケーションモニタリング
- **Sentry**
  - エラー追跡
  - パフォーマンスモニタリング
  - 無料枠が十分

### ロギング
- **CloudWatch Logs** (Fly.io統合)
  - ログの集中管理
  - アラート設定
  - 長期保存

## 7. セキュリティ

### シークレット管理
- Vercel: 環境変数
- Fly.io: シークレット
- Supabase: Vault

### 認証・認可
- Discord OAuth2.0
- Microsoft OAuth2.0
- Supabase RLS

## 8. 更新・メンテナンス方針

### バージョン管理
- セマンティックバージョニングの採用
- 依存パッケージの定期的な更新（月1回）
- セキュリティアップデートの即時適用

### モニタリング
- Sentryによるエラー監視
- CloudWatch Logsによるログ分析
- Supabaseのデータベース監視 